<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reports – M&T Equipment Funding LLC</title>
  <link rel="icon" href="https://i.imgur.com/kopRNDu.png" type="image/png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --font-main: "Inter","Segoe UI",system-ui,-apple-system,sans-serif;
      --accent: #005e4a;
      --logo-scale: 2;
    }
    * { box-sizing: border-box; font-family: var(--font-main); }
    body { margin:0; background:#f5f7f6; color:#0b2520; }
    a { color: inherit; text-decoration: none; }
    header { background:#ffffff; position: sticky; top:0; z-index:10; box-shadow:0 2px 6px rgba(0,0,0,.08); }
    .nav { max-width:1100px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; padding:10px 20px; gap:12px; }
    .logo { display:flex; align-items:center; gap:10px; }
    .logo img { height:60px; width:auto; object-fit:contain; transform:scale(var(--logo-scale)); transform-origin:left center; }
    .nav-links { display:flex; align-items:center; gap:18px; font-size:14px; flex-wrap:wrap; }
    .nav-links a { padding:6px 10px; border-radius:999px; }
    .nav-links a:hover { background:rgba(0,94,74,.08); }
    .nav-links .active { background:var(--accent); color:#fff; }
    .btn-small { border-radius:999px; border:1px solid var(--accent); padding:10px 22px; font-size:14px; font-weight:700; color:var(--accent); background:#fff; cursor:pointer; }
    .btn-small:hover { background:var(--accent); color:#fff; }

    main { max-width:1100px; margin:20px auto 40px; padding:0 20px; position:relative; z-index:1; }
    .card { background:#ffffff; border-radius:14px; padding:18px 20px; box-shadow:0 4px 14px rgba(0,0,0,.05); border:1px solid #e3ece9; margin-bottom:16px; }
    h1 { margin:0 0 6px; font-size:26px; }
    p { margin:0 0 10px; color:#3a4c45; }
    table { width:100%; border-collapse:collapse; }
    th, td { text-align:left; padding:10px 8px; font-size:14px; }
    th { background:#f5f7f6; color:#0b2520; border-bottom:1px solid #e0e7e4; }
    tr + tr td { border-top:1px solid #eef2f0; }
    tr.clickable:hover { background:#f0faf7; cursor:pointer; }
    .bar { height:8px; border-radius:999px; background:#d9ede6; overflow:hidden; margin-top:6px; }
    .bar > span { display:block; height:100%; background:var(--accent); }
    .detail-list { margin:0; padding:0; list-style:none; }
    .detail-list li { display:flex; justify-content:space-between; padding:6px 0; border-bottom:1px solid #eef2f0; font-size:14px; }
    .detail-list li:last-child { border-bottom:none; }
    .muted { color:#4f615c; font-size:13px; }

    .overlay { position:fixed; inset:0; background:rgba(0,0,0,0.45); display:flex; align-items:center; justify-content:center; z-index:30; }
    .overlay.hidden { display:none; }
    .overlay-card { background:#ffffff; padding:20px 22px; border-radius:14px; width:320px; box-shadow:0 10px 28px rgba(0,0,0,.18); text-align:center; }
    .overlay-card h2 { margin:0 0 10px; }
    .overlay-card p { margin:0 0 12px; font-size:14px; color:#3a4c45; }
    .overlay-card input { width:100%; padding:10px 12px; border-radius:10px; border:1px solid #cfdcd6; margin-bottom:10px; font-size:14px; }
    .overlay-card button { width:100%; border:none; border-radius:10px; padding:12px; background:var(--accent); color:#fff; font-weight:700; cursor:pointer; }
    .error { color:#b00020; font-size:12px; min-height:16px; margin-top:4px; }

    @media (max-width:720px) { .nav { flex-direction:column; align-items:flex-start; gap:10px; } .nav-links { width:100%; } .btn-small { width:100%; text-align:center; } table { display:block; overflow:auto; } }
  </style>
</head>
<body>
  <header>
    <div class="nav">
      <div class="logo">
        <a href="index.html"><img src="Media/LogoTransparent.png" alt="M&T Equipment Funding Logo"></a>
      </div>
      <nav class="nav-links">
        <a href="index.html" data-track-id="nav_home" data-track-label="Header Home Link">Home</a>
        <a href="Applications.html" data-track-id="nav_applications" data-track-label="Header Applications Link">Applications</a>
        <a href="Services.html" data-track-id="nav_services" data-track-label="Header Services Link">Services</a>
        <div class="dropdown" style="position:relative;">
          <a href="Inventory.html" data-track-id="nav_inventory" data-track-label="Header Inventory Link">Inventory ▾</a>
          <div class="dropdown-menu" style="position:absolute; top:28px; left:0; background:#ffffff; border:1px solid #e3ece9; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,.08); padding:6px 0; display:none; min-width:180px;">
            <a href="Inventory.html" style="display:block; padding:8px 12px;" data-track-id="nav_inventory_overview" data-track-label="Inventory Overview">Inventory overview</a>
            <a href="Units for Sale.html" style="display:block; padding:8px 12px;" data-track-id="nav_units" data-track-label="All Units for Sale">All Units for Sale</a>
          </div>
        </div>
        <a href="About us.html" data-track-id="nav_about" data-track-label="Header About Link">About Us</a>
        <a href="Reports.html" class="active" data-track-id="nav_reports" data-track-label="Header Reports Link">Reports</a>
        <button class="btn-small" type="button" data-track-id="cta_talk_rep" data-track-label="Talk to Representative" onclick="window.location.href='tel:2012013551'">Talk to Representative</button>
      </nav>
    </div>
  </header>

  <div class="overlay" id="accessOverlay">
    <div class="overlay-card">
      <h2>Admin / Manager Access</h2>
      <p>Enter the password to view analytics.</p>
      <input type="password" id="accessPassword" placeholder="Password" />
      <button id="accessButton">Login</button>
      <div class="error" id="accessError"></div>
    </div>
  </div>

  <main>
    <section class="card">
      <h1>Click Analytics (Local)</h1>
      <p>Data is stored in your browser via localStorage for testing; a real backend can be added later.</p>
      <p class="muted">Click a row to see per-page details. Bars are proportional to the most-clicked item.</p>
    </section>

    <section class="card">
      <h2 style="margin:0 0 8px;">Summary</h2>
      <div style="overflow:auto;">
        <table>
          <thead>
            <tr><th>Event ID</th><th>Label</th><th>Total Clicks</th><th style="width:200px;">Activity</th></tr>
          </thead>
          <tbody id="summaryBody"></tbody>
        </table>
      </div>
    </section>

    <section class="card" id="detailSection" style="display:none;">
      <h2 style="margin:0 0 8px;">Event Details</h2>
      <div class="muted" id="detailLabel"></div>
      <ul class="detail-list" id="detailList"></ul>
    </section>
  </main>

  <script src="analytics.js"></script>
  <script>
    const ADMIN_PASSWORD = "MNTADMIN123";
    const ACCESS_KEY = "mntAnalyticsAccess";

    const overlay = document.getElementById('accessOverlay');
    const passwordInput = document.getElementById('accessPassword');
    const accessButton = document.getElementById('accessButton');
    const accessError = document.getElementById('accessError');
    const summaryBody = document.getElementById('summaryBody');
    const detailSection = document.getElementById('detailSection');
    const detailLabel = document.getElementById('detailLabel');
    const detailList = document.getElementById('detailList');
    const dropdown = document.querySelector('.dropdown');
    const dropdownMenu = dropdown?.querySelector('.dropdown-menu');

    function showMenu() {
      if (dropdownMenu) dropdownMenu.style.display = 'block';
    }
    function hideMenu() {
      if (dropdownMenu) dropdownMenu.style.display = 'none';
    }

    dropdown?.addEventListener('mouseenter', showMenu);
    dropdown?.addEventListener('mouseleave', () => {
      setTimeout(hideMenu, 300);
    });

    function hasAccess() {
      return localStorage.getItem(ACCESS_KEY) === 'true';
    }

    function grantAccess() {
      localStorage.setItem(ACCESS_KEY, 'true');
      overlay.classList.add('hidden');
      renderSummary();
    }

    function handleLogin() {
      const value = passwordInput.value.trim();
      if (value === ADMIN_PASSWORD) {
        accessError.textContent = '';
        grantAccess();
      } else {
        accessError.textContent = 'Incorrect password. Please try again.';
      }
    }

    accessButton.addEventListener('click', handleLogin);
    passwordInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        handleLogin();
      }
    });

    function renderSummary() {
      const data = window.mntAnalytics.loadAnalytics();
      const events = Object.values(data);
      summaryBody.innerHTML = '';
      detailSection.style.display = 'none';

      if (!events.length) {
        const row = document.createElement('tr');
        const cell = document.createElement('td');
        cell.colSpan = 4;
        cell.textContent = 'No click data recorded yet.';
        row.appendChild(cell);
        summaryBody.appendChild(row);
        return;
      }

      const max = Math.max(...events.map(e => e.total || 0), 1);

      events.sort((a, b) => (b.total || 0) - (a.total || 0));

      events.forEach(event => {
        const row = document.createElement('tr');
        row.classList.add('clickable');
        row.innerHTML = `
          <td>${event.id}</td>
          <td>${event.label || event.id}</td>
          <td>${event.total || 0}</td>
          <td><div class="bar"><span style="width:${Math.max((event.total || 0) / max * 100, 4)}%"></span></div></td>
        `;
        row.addEventListener('click', () => renderDetail(event));
        summaryBody.appendChild(row);
      });
    }

    function renderDetail(event) {
      detailLabel.textContent = `${event.label || event.id} (${event.id})`;
      detailList.innerHTML = '';
      const pages = event.pages || {};
      const entries = Object.keys(pages).length ? Object.entries(pages) : [['No page data', 0]];
      entries.forEach(([path, count]) => {
        const item = document.createElement('li');
        const pageSpan = document.createElement('span');
        pageSpan.textContent = path;
        const countSpan = document.createElement('span');
        countSpan.textContent = count;
        item.appendChild(pageSpan);
        item.appendChild(countSpan);
        detailList.appendChild(item);
      });
      detailSection.style.display = 'block';
    }

    document.addEventListener('DOMContentLoaded', () => {
      if (hasAccess()) {
        overlay.classList.add('hidden');
        renderSummary();
      }
    });
  </script>
</body>
</html>
